{
  "id": null,
  "uid": "mava-ticket-overview",
  "title": "Mava Tickets",
  "tags": ["mava_tickets_with_customers", "overview"],
  "timezone": "browser",
  "schemaVersion": 37,
  "version": 8,
  "refresh": "5m",
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "panels": [
    {
      "id": 11,
      "type": "stat",
      "title": "Open Tickets",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 5, "x": 0, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS count FROM mava_tickets_with_customers WHERE status = 'Open';",
          "refId": "A"
        }
      ]
    },
    {
      "id": 12,
      "type": "stat",
      "title": "Pending Tickets",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 5, "x": 5, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS count FROM mava_tickets_with_customers WHERE status = 'Pending';",
          "refId": "A"
        }
      ]
    },
    {
      "id": 13,
      "type": "stat",
      "title": "Waiting Tickets",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 5, "x": 10, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS count FROM mava_tickets_with_customers WHERE status = 'Waiting';",
          "refId": "A"
        }
      ]
    },
    {
      "id": 14,
      "type": "stat",
      "title": "Resolved Tickets",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 5, "x": 15, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS count FROM mava_tickets_with_customers WHERE status = 'Resolved';",
          "refId": "A"
        }
      ]
    },
    {
      "id": 1,
      "type": "stat",
      "title": "Total Tickets",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 4, "x": 20, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_mava_tickets_with_customers FROM mava_tickets_with_customers;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 20,
      "type": "stat",
      "title": "Tickets by Status (%)",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 12, "x": 6, "y": 4},
      "fieldConfig": {
        "defaults": {
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            }
          }
        }
      },
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "displayMode": "pie"
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT status, COUNT(*) AS count FROM mava_tickets_with_customers GROUP BY status ORDER BY count DESC;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 3,
      "type": "timeseries",
      "title": "Created Over Time",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
      "targets": [
        {
          "format": "time_series",
          "rawSql": "SELECT date_trunc('day', created_at) AS time, COUNT(*) AS count FROM mava_tickets_with_customers WHERE created_at IS NOT NULL GROUP BY time ORDER BY time;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 18,
      "title": "Open Tickets",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 12, "w": 24, "x": 0, "y": 20},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT t.id AS \"Ticket ID\", t.status AS \"Status\", t.priority AS \"Priority\", t.category AS \"Category\", COALESCE(t.customer_name, 'Unknown') AS \"Customer\", t.source_type AS \"Source\", t.assigned_to AS \"Assigned To\", t.created_at AS \"Created\", t.updated_at AS \"Last Updated\" FROM mava_tickets_with_customers t WHERE t.status IN ('Open', 'Pending', 'Waiting') ORDER BY t.updated_at DESC LIMIT 50;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Source"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 100
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Status"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Priority"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Category"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 100
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Customer"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Assigned To"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Created"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Last Updated"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          }
        ]
      }
    },
    {
      "id": 10,
      "title": "Most Common Words in Support Tickets",
      "type": "barchart",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 40},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH words AS (SELECT unnest(string_to_array(lower(regexp_replace(content, '[^a-zA-Z0-9\\s]', '', 'g')), ' ')) AS word FROM mava_messages WHERE content IS NOT NULL AND content <> '' AND LENGTH(content) > 3), filtered_words AS (SELECT word FROM words WHERE LENGTH(word) > 3 AND word NOT IN ('this', 'that', 'with', 'have', 'will', 'from', 'they', 'been', 'were', 'said', 'each', 'which', 'their', 'what', 'about', 'would', 'there', 'could', 'more', 'very', 'than', 'just', 'like', 'only', 'into', 'over', 'also', 'back', 'after', 'use', 'two', 'how', 'our', 'work', 'first', 'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us', 'hello', 'thanks', 'please')) SELECT word AS \"Word\", COUNT(*) AS \"Frequency\" FROM filtered_words GROUP BY word ORDER BY COUNT(*) DESC LIMIT 20;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "displayMode": "list",
            "filterable": false,
            "showUnfilled": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Word"
            },
            "properties": [
              {
                "id": "custom.axisPlacement",
                "value": "bottom"
              },
              {
                "id": "custom.axisLabel",
                "value": "Words"
              }
            ]
          }
        ]
      },
      "options": {
        "orientation": "vertical",
        "displayMode": "gradient",
        "xTickLabelRotation": 45,
        "xTickLabelSpacing": 0,
        "showValue": "always",
        "groupWidth": 0.7,
        "barWidth": 0.97
      }
    }
  ]
} 