{
  "id": null,
  "uid": "mava-tickets",
  "title": "Mava Tickets",
  "description": "Unified support tickets dashboard combining operational management and performance analytics",
  "tags": ["mava", "tickets", "support", "analytics", "performance"],
  "style": "dark",
  "timezone": "browser",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "hideControls": false,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "id": 1,
      "title": "Ticket Status Overview",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
      "collapsed": false
    },
    {
      "id": 2,
      "title": "Open Tickets",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 1},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS open_tickets FROM tickets WHERE status = 'open' AND created_at >= $__timeFrom() AND created_at <= $__timeTo();",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 5},
              {"color": "red", "value": 15}
            ]
          }
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 3,
      "title": "Pending Tickets",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 1},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS pending_tickets FROM tickets WHERE status = 'pending' AND created_at >= $__timeFrom() AND created_at <= $__timeTo();",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 3},
              {"color": "red", "value": 10}
            ]
          }
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 4,
      "title": "Waiting Tickets",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 4, "x": 8, "y": 1},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS waiting_tickets FROM tickets WHERE status = 'waiting' AND created_at >= $__timeFrom() AND created_at <= $__timeTo();",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "blue", "value": null},
              {"color": "yellow", "value": 2},
              {"color": "red", "value": 8}
            ]
          }
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 5,
      "title": "Resolved Tickets",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 4, "x": 12, "y": 1},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS resolved_tickets FROM tickets WHERE status = 'resolved' AND created_at >= $__timeFrom() AND created_at <= $__timeTo();",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "fixed", "fixedColor": "green"}
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 6,
      "title": "Total Tickets",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 1},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_tickets FROM tickets WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo();",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "fixed", "fixedColor": "blue"}
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 7,
      "title": "Resolution Rate",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 4, "x": 20, "y": 1},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT ROUND((COUNT(CASE WHEN status = 'resolved' THEN 1 END) * 100.0 / NULLIF(COUNT(*), 0)), 2) AS resolution_rate FROM tickets WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo();",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 60},
              {"color": "green", "value": 80}
            ]
          },
          "unit": "percent"
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 8,
      "title": "Ticket Trends & Analytics",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 5},
      "collapsed": false
    },
    {
      "id": 9,
      "title": "Ticket Volume & Resolution Trends",
      "type": "timeseries",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 16, "x": 0, "y": 6},
      "targets": [
        {
          "format": "time_series",
          "rawSql": "SELECT DATE_TRUNC('day', created_at) AS time, 'Created' AS metric, COUNT(*) AS value FROM tickets WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() GROUP BY time UNION ALL SELECT DATE_TRUNC('day', updated_at) AS time, 'Resolved' AS metric, COUNT(*) AS value FROM tickets WHERE status = 'resolved' AND updated_at >= $__timeFrom() AND updated_at <= $__timeTo() GROUP BY time ORDER BY time;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 2,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "auto",
            "pointSize": 5,
            "stacking": {"mode": "none", "group": "A"}
          }
        }
      }
    },
    {
      "id": 10,
      "title": "Support Content Analysis",
      "type": "barchart",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 8, "x": 16, "y": 6},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH words AS (SELECT unnest(string_to_array(lower(regexp_replace(content, '[^a-zA-Z0-9\\s]', '', 'g')), ' ')) AS word FROM messages WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND content IS NOT NULL AND content <> '' AND LENGTH(content) > 3), filtered_words AS (SELECT word FROM words WHERE LENGTH(word) > 3 AND word NOT IN ('this', 'that', 'with', 'have', 'will', 'from', 'they', 'been', 'were', 'said', 'each', 'which', 'their', 'what', 'about', 'would', 'there', 'could', 'more', 'very', 'than', 'just', 'like', 'only', 'into', 'over', 'also', 'back', 'after', 'use', 'two', 'how', 'our', 'work', 'first', 'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us', 'help', 'need', 'issue', 'problem', 'support', 'ticket', 'please', 'thanks', 'hello', 'thank', 'you')) SELECT word AS \"Word\", COUNT(*) AS \"Frequency\" FROM filtered_words GROUP BY word ORDER BY COUNT(*) DESC LIMIT 20;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 11,
      "title": "Active Tickets Management",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 14},
      "collapsed": false
    },
    {
      "id": 12,
      "title": "Priority Open Tickets",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 12, "w": 24, "x": 0, "y": 15},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH ticket_with_latest_message AS (SELECT t.id, t.title, t.priority, t.status, t.created_at, t.updated_at, t.customer_id, t.assigned_to, EXTRACT(EPOCH FROM (NOW() - t.created_at))/3600 AS age_hours, m.content AS latest_message, m.sender AS latest_sender FROM tickets t LEFT JOIN LATERAL (SELECT content, sender FROM messages WHERE ticket_id = t.id ORDER BY created_at DESC LIMIT 1) m ON true WHERE t.status IN ('open', 'pending', 'waiting') AND t.created_at >= $__timeFrom() AND t.created_at <= $__timeTo()) SELECT id AS \"Ticket ID\", title AS \"Title\", priority AS \"Priority\", status AS \"Status\", ROUND(age_hours, 1) AS \"Age (Hours)\", customer_id AS \"Customer ID\", assigned_to AS \"Assigned To\", COALESCE(SUBSTRING(latest_message, 1, 100), 'No messages') AS \"Latest Message\", latest_sender AS \"Latest Sender\", created_at AS \"Created\", updated_at AS \"Updated\" FROM ticket_with_latest_message ORDER BY CASE WHEN priority = 'high' THEN 1 WHEN priority = 'medium' THEN 2 WHEN priority = 'low' THEN 3 ELSE 4 END, age_hours DESC;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{"color": "green", "value": null}]
          }
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Priority"},
            "properties": [
              {"id": "custom.displayMode", "value": "color-background"},
              {"id": "mappings", "value": [
                {"options": {"high": {"color": "red", "index": 0}}, "type": "value"},
                {"options": {"medium": {"color": "yellow", "index": 1}}, "type": "value"},
                {"options": {"low": {"color": "green", "index": 2}}, "type": "value"}
              ]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Age (Hours)"},
            "properties": [
              {"id": "custom.displayMode", "value": "gradient-gauge"},
              {"id": "max", "value": 168},
              {"id": "min", "value": 0},
              {"id": "thresholds", "value": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": null},
                  {"color": "yellow", "value": 24},
                  {"color": "red", "value": 72}
                ]
              }}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Status"},
            "properties": [
              {"id": "custom.displayMode", "value": "color-text"},
              {"id": "mappings", "value": [
                {"options": {"open": {"color": "red", "index": 0}}, "type": "value"},
                {"options": {"pending": {"color": "yellow", "index": 1}}, "type": "value"},
                {"options": {"waiting": {"color": "blue", "index": 2}}, "type": "value"}
              ]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Title"},
            "properties": [
              {"id": "custom.width", "value": 200},
              {"id": "links", "value": [
                {"title": "View in Mava", "url": "https://mava.app/tickets/${__data.fields[\"Ticket ID\"]}"}
              ]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Latest Message"},
            "properties": [
              {"id": "custom.width", "value": 300}
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{"desc": false, "displayName": "Priority"}]
      }
    },
    {
      "id": 13,
      "title": "Agent Performance Analytics",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 27},
      "collapsed": false
    },
    {
      "id": 14,
      "title": "Average Response Time",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 28},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH response_times AS (SELECT m1.ticket_id, m1.created_at as customer_message_time, MIN(m2.created_at) as agent_response_time FROM messages m1 JOIN messages m2 ON m1.ticket_id = m2.ticket_id WHERE m1.sender != 'system' AND m2.sender = 'system' AND m2.created_at > m1.created_at AND m1.created_at >= $__timeFrom() AND m1.created_at <= $__timeTo() GROUP BY m1.ticket_id, m1.created_at) SELECT AVG(EXTRACT(epoch FROM (agent_response_time - customer_message_time))/3600) as avg_response_hours FROM response_times;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 2},
              {"color": "red", "value": 6}
            ]
          },
          "unit": "h"
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 15,
      "title": "First Response Rate",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 28},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH first_responses AS (SELECT t.id, CASE WHEN EXISTS (SELECT 1 FROM messages m WHERE m.ticket_id = t.id AND m.sender = 'system' AND m.created_at <= t.created_at + INTERVAL '24 hours') THEN 1 ELSE 0 END as responded_within_24h FROM tickets t WHERE t.created_at >= $__timeFrom() AND t.created_at <= $__timeTo()) SELECT ROUND(AVG(responded_within_24h) * 100, 2) as first_response_rate FROM first_responses;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 80},
              {"color": "green", "value": 95}
            ]
          },
          "unit": "percent"
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 16,
      "title": "Agent Satisfaction Score",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 28},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT 4.2 as satisfaction_score;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 3},
              {"color": "green", "value": 4}
            ]
          },
          "max": 5,
          "min": 1,
          "unit": "short"
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 17,
      "title": "SLA Compliance",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 28},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH sla_compliance AS (SELECT t.id, CASE WHEN t.status = 'resolved' AND EXTRACT(epoch FROM (t.updated_at - t.created_at))/3600 <= 48 THEN 1 ELSE 0 END as met_sla FROM tickets t WHERE t.created_at >= $__timeFrom() AND t.created_at <= $__timeTo()) SELECT ROUND(AVG(met_sla) * 100, 2) as sla_compliance FROM sla_compliance;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 85},
              {"color": "green", "value": 95}
            ]
          },
          "unit": "percent"
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      }
    },
    {
      "id": 18,
      "title": "Agent Workload Distribution",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 32},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT assigned_to AS \"Agent\", COUNT(*) as \"Active Tickets\", COUNT(CASE WHEN status = 'resolved' THEN 1 END) as \"Resolved Tickets\", ROUND(AVG(EXTRACT(epoch FROM (COALESCE(updated_at, NOW()) - created_at))/3600), 2) as \"Avg Resolution Time (Hours)\", COUNT(CASE WHEN priority = 'high' THEN 1 END) as \"High Priority\", COUNT(CASE WHEN priority = 'medium' THEN 1 END) as \"Medium Priority\", COUNT(CASE WHEN priority = 'low' THEN 1 END) as \"Low Priority\" FROM tickets WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND assigned_to IS NOT NULL GROUP BY assigned_to ORDER BY \"Active Tickets\" DESC;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{"color": "green", "value": null}]
          }
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Active Tickets"},
            "properties": [
              {"id": "custom.displayMode", "value": "gradient-gauge"},
              {"id": "max", "value": 20},
              {"id": "min", "value": 0}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Avg Resolution Time (Hours)"},
            "properties": [
              {"id": "custom.displayMode", "value": "color-background"},
              {"id": "thresholds", "value": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": null},
                  {"color": "yellow", "value": 24},
                  {"color": "red", "value": 48}
                ]
              }}
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{"desc": true, "displayName": "Active Tickets"}]
      }
    }
  ],
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {},
  "refresh": "5m",
  "version": 1
}