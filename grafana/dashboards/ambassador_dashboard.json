{
  "id": null,
  "uid": "community-ambassadors",
  "title": "Community Ambassadors",
  "tags": [
    "ambassador",
    "x",
    "twitter",
    "discord",
    "telegram",
    "social"
  ],
  "timezone": "browser",
  "panels": [
    {
      "id": 1,
      "title": "Total Ambassadors",
      "type": "stat",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_ambassadors FROM community_ambassadors;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 2,
      "title": "Ambassador Discord Posts",
      "type": "stat",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS discord_posts FROM discord_messages dm JOIN community_ambassadors ca ON dm.author_id::bigint = ca.discord_id WHERE dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 3,
      "title": "Ambassador Telegram Posts",
      "type": "stat",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 0
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS telegram_posts FROM telegram_messages tm JOIN community_ambassadors ca ON tm.from_user_id = ca.telegram_id WHERE tm.date >= $__timeFrom() AND tm.date <= $__timeTo();",
          "refId": "A"
        }
      ]
    },
    {
      "id": 4,
      "title": "Ambassador X Posts",
      "type": "stat",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 18,
        "y": 0
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(DISTINCT dm.id) AS x_posts FROM discord_messages dm CROSS JOIN community_ambassadors ca WHERE dm.channel_id = '1248750328896295084' AND dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false AND dm.content ILIKE '%' || ca.x_handle || '%';",
          "refId": "A"
        }
      ]
    },
    {
      "id": 5,
      "title": "Community Ambassadors Overview",
      "type": "table",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 4
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT ca.ambassador AS \"Ambassador\", ca.role AS \"Role\", ca.x_handle AS \"X Handle\", COALESCE(tm_data.telegram_username, 'Not Available') AS \"Telegram Username\", COALESCE(dm_data.discord_username, 'Not Available') AS \"Discord Username\", ca.telegram_id AS \"Telegram ID\", ca.discord_id AS \"Discord ID\" FROM community_ambassadors ca LEFT JOIN (SELECT DISTINCT tm.from_user_id, tm.from_user_username as telegram_username FROM telegram_messages tm WHERE tm.from_user_username IS NOT NULL) tm_data ON ca.telegram_id = tm_data.from_user_id LEFT JOIN (SELECT DISTINCT dm.author_id::bigint, dm.author_username as discord_username FROM discord_messages dm WHERE dm.author_username IS NOT NULL) dm_data ON ca.discord_id = dm_data.author_id ORDER BY ca.ambassador;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Ambassador"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Role"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 200
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "X Handle"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Telegram Username"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 200
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Discord Username"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 200
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Telegram ID"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Discord ID"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          }
        ]
      }
    },
    {
      "id": 7,
      "title": "Ambassador Activity by Platform",
      "type": "barchart",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "\n            WITH platform_stats AS (\n                SELECT\n                    'Discord' AS platform,\n                    COUNT(*) AS posts\n                FROM\n                    discord_messages dm\n                JOIN\n                    community_ambassadors ca ON dm.author_id::bigint = ca.discord_id\n                WHERE\n                    dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false\n\n                UNION ALL\n\n                SELECT\n                    'Telegram' AS platform,\n                    COUNT(*) AS posts\n                FROM\n                    telegram_messages tm\n                JOIN\n                    community_ambassadors ca ON tm.from_user_id = ca.telegram_id\n                WHERE\n                    tm.date >= $__timeFrom() AND tm.date <= $__timeTo()\n\n                UNION ALL\n\n                SELECT\n                    'X (Twitter)' AS platform,\n                    COUNT(DISTINCT dm.id) AS posts\n                FROM\n                    discord_messages dm\n                CROSS JOIN\n                    community_ambassadors ca\n                WHERE\n                    dm.channel_id = '1248750328896295084'\n                    AND dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo()\n                    AND dm.author_is_bot = false\n                    AND dm.content ILIKE '%' || ca.x_handle || '%'\n            )\n            SELECT\n                platform AS \"Platform\",\n                posts AS \"Posts\"\n            FROM\n                platform_stats\n            WHERE\n                posts > 0\n            ORDER BY\n                posts DESC;\n        ",
          "refId": "A"
        }
      ]
    },
    {
      "id": 11,
      "title": "Ambassador Daily Activity Timeline",
      "type": "timeseries",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 32
      },
      "targets": [
        {
          "format": "time_series",
          "rawSql": "\n            WITH daily_activity AS (\n                SELECT\n                    date_trunc('day', dm.created_at) AS time,\n                    'Discord' AS platform,\n                    COUNT(*) AS posts\n                FROM\n                    discord_messages dm\n                JOIN\n                    community_ambassadors ca ON dm.author_id::bigint = ca.discord_id\n                WHERE\n                    dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false\n                GROUP BY\n                    date_trunc('day', dm.created_at)\n\n                UNION ALL\n\n                SELECT\n                    date_trunc('day', tm.date) AS time,\n                    'Telegram' AS platform,\n                    COUNT(*) AS posts\n                FROM\n                    telegram_messages tm\n                JOIN\n                    community_ambassadors ca ON tm.from_user_id = ca.telegram_id\n                WHERE\n                    tm.date >= $__timeFrom() AND tm.date <= $__timeTo()\n                GROUP BY\n                    date_trunc('day', tm.date)\n\n                UNION ALL\n\n                SELECT\n                    date_trunc('day', dm.created_at) AS time,\n                    'X (Twitter)' AS platform,\n                    COUNT(DISTINCT dm.id) AS posts\n                FROM\n                    discord_messages dm\n                CROSS JOIN\n                    community_ambassadors ca\n                WHERE\n                    dm.channel_id = '1248750328896295084'\n                    AND dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo()\n                    AND dm.author_is_bot = false\n                    AND dm.content ILIKE '%' || ca.x_handle || '%'\n                GROUP BY\n                    date_trunc('day', dm.created_at)\n            )\n            SELECT\n                time,\n                platform AS metric,\n                posts AS value\n            FROM\n                daily_activity\n            ORDER BY\n                time, platform;\n        ",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 2,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "auto",
            "pointSize": 5,
            "stacking": {
              "mode": "none",
              "group": "A"
            }
          }
        }
      }
    },
    {
      "id": 12,
      "title": "Ambassador Stats",
      "type": "table",
      "datasource": {
        "type": "postgres",
        "uid": "supabase"
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 24
      },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT ca.ambassador AS \"Ambassador\", ca.role AS \"Role\", COALESCE(discord_posts.posts, 0) AS \"Discord Posts\", COALESCE(telegram_posts.posts, 0) AS \"Telegram Posts\", COALESCE(x_posts.posts, 0) AS \"X Posts\", COALESCE(discord_posts.posts, 0) + COALESCE(telegram_posts.posts, 0) + COALESCE(x_posts.posts, 0) AS \"Total Posts\" FROM community_ambassadors ca LEFT JOIN (SELECT ca_sub.ambassador, COUNT(*) AS posts FROM discord_messages dm JOIN community_ambassadors ca_sub ON dm.author_id::bigint = ca_sub.discord_id WHERE dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false GROUP BY ca_sub.ambassador) discord_posts ON ca.ambassador = discord_posts.ambassador LEFT JOIN (SELECT ca_sub.ambassador, COUNT(*) AS posts FROM telegram_messages tm JOIN community_ambassadors ca_sub ON tm.from_user_id = ca_sub.telegram_id WHERE tm.date >= $__timeFrom() AND tm.date <= $__timeTo() GROUP BY ca_sub.ambassador) telegram_posts ON ca.ambassador = telegram_posts.ambassador LEFT JOIN (SELECT ca_sub.ambassador, COUNT(DISTINCT dm.id) AS posts FROM discord_messages dm CROSS JOIN community_ambassadors ca_sub WHERE dm.channel_id = '1248750328896295084' AND dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false AND dm.content ILIKE '%' || ca_sub.x_handle || '%' GROUP BY ca_sub.ambassador) x_posts ON ca.ambassador = x_posts.ambassador ORDER BY \"Total Posts\" DESC;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        }
      }
    }
  ],
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {},
  "refresh": "5m",
  "version": 1
}