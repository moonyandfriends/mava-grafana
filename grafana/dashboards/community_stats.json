{
  "id": null,
  "uid": "community-stats",
  "title": "Community Stats",
  "tags": ["community", "stats", "discord", "telegram"],
  "timezone": "browser",
  "panels": [
    {
      "id": 1,
      "title": "Total Discord Messages",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_messages FROM discord_messages WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND author_is_bot = false;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 2,
      "title": "Total Discord Messages (All Time)",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_messages FROM discord_messages WHERE author_is_bot = false;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 3,
      "title": "Total Telegram Messages",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_messages FROM telegram_messages WHERE date >= $__timeFrom() AND date <= $__timeTo();",
          "refId": "A"
        }
      ]
    },
    {
      "id": 4,
      "title": "Total Telegram Messages (All Time)",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(*) AS total_messages FROM telegram_messages;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 5,
      "title": "Active Discord Users",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 4},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(DISTINCT author_id) AS active_users FROM discord_messages WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND author_is_bot = false;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 6,
      "title": "Active Discord Users (All Time)",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 4},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(DISTINCT author_id) AS active_users FROM discord_messages WHERE author_is_bot = false;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 7,
      "title": "Active Telegram Users",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 4},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(DISTINCT from_user_id) AS active_users FROM telegram_messages WHERE date >= $__timeFrom() AND date <= $__timeTo();",
          "refId": "A"
        }
      ]
    },
    {
      "id": 8,
      "title": "Active Telegram Users (All Time)",
      "type": "stat",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 4},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COUNT(DISTINCT from_user_id) AS active_users FROM telegram_messages;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 9,
      "title": "Top Discord Community Activity",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 12, "w": 12, "x": 0, "y": 22},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COALESCE(author_display_name, author_username) AS \"Community Member\", author_username AS Username, author_id AS UserID, COUNT(*) AS Messages FROM discord_messages WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND author_is_bot = false GROUP BY author_id, author_username, author_display_name ORDER BY Messages DESC LIMIT 20;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        }
      }
    },
    {
      "id": 10,
      "title": "Top Telegram Community Activity",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 12, "w": 12, "x": 12, "y": 22},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COALESCE(tm.from_user_first_name || ' ' || tm.from_user_last_name, tm.from_user_first_name) AS \"Community Member\", tm.from_user_username AS Username, tm.from_user_id AS UserID, COUNT(*) AS Messages FROM telegram_messages tm WHERE tm.date >= $__timeFrom() AND tm.date <= $__timeTo() AND tm.from_user_is_bot = false GROUP BY tm.from_user_id, tm.from_user_first_name, tm.from_user_last_name, tm.from_user_username ORDER BY Messages DESC LIMIT 20;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        }
      }
    },
    {
      "id": 16,
      "title": "Latest Discord Messages",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 12, "w": 12, "x": 0, "y": 34},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COALESCE(dm.author_display_name, dm.author_username) AS \"Author\", dm.content AS \"Message\", dm.created_at AS \"Time\", dc.name AS \"Channel\" FROM discord_messages dm LEFT JOIN discord_channels dc ON dm.channel_id = dc.channel_id WHERE dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false AND dm.content IS NOT NULL AND dm.content <> '' ORDER BY dm.created_at DESC LIMIT 50;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Message"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 400
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          }
        ]
      }
    },
    {
      "id": 17,
      "title": "Latest Telegram Messages",
      "type": "table",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 12, "w": 12, "x": 12, "y": 34},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT COALESCE(tm.from_user_first_name || ' ' || tm.from_user_last_name, tm.from_user_first_name) AS \"Author\", tm.text AS \"Message\", tm.date AS \"Time\" FROM telegram_messages tm WHERE tm.date >= $__timeFrom() AND tm.date <= $__timeTo() AND tm.from_user_is_bot = false AND tm.text IS NOT NULL AND tm.text <> '' ORDER BY tm.date DESC LIMIT 50;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "table",
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Message"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 400
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          }
        ]
      }
    },
    {
      "id": 11,
      "title": "Discord Daily Message Activity",
      "type": "timeseries",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 46},
      "targets": [
        {
          "format": "time_series",
          "rawSql": "SELECT date_trunc('day', created_at) AS time, COUNT(*) AS messages FROM discord_messages WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND author_is_bot = false GROUP BY time ORDER BY time;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 1,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "never",
            "pointSize": 5,
            "stacking": {
              "mode": "none",
              "group": "A"
            },
            "axisPlacement": "auto",
            "axisLabel": "",
            "scaleDistribution": {
              "type": "linear"
            },
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          }
        }
      }
    },
    {
      "id": 12,
      "title": "Telegram Daily Message Activity",
      "type": "timeseries",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 46},
      "targets": [
        {
          "format": "time_series",
          "rawSql": "SELECT date_trunc('day', date) AS time, COUNT(*) AS messages FROM telegram_messages WHERE date >= $__timeFrom() AND date <= $__timeTo() GROUP BY time ORDER BY time;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 1,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "never",
            "pointSize": 5,
            "stacking": {
              "mode": "none",
              "group": "A"
            },
            "axisPlacement": "auto",
            "axisLabel": "",
            "scaleDistribution": {
              "type": "linear"
            },
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          }
        }
      }
    },
    {
      "id": 13,
      "title": "Discord Channel Activity (Top 10 Channels)",
      "type": "barchart",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 54},
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT dc.name AS Channel, COUNT(dm.*) AS Messages FROM discord_messages dm JOIN discord_channels dc ON dm.channel_id = dc.channel_id WHERE dm.created_at >= $__timeFrom() AND dm.created_at <= $__timeTo() AND dm.author_is_bot = false AND dm.channel_id NOT IN ('1065252962470994021', '1336461137767563304', '1068618500656078849', '1092260477658214492', '1063595387513999430', '1063540719857442876', '1063533369574568027') GROUP BY dc.name ORDER BY Messages DESC LIMIT 10;",
          "refId": "A"
        }
      ]
    },
    {
      "id": 14,
      "title": "Most Common Words in Discord",
      "type": "barchart",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 14},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH words AS (SELECT unnest(string_to_array(lower(regexp_replace(content, '[^a-zA-Z0-9\\s]', '', 'g')), ' ')) AS word FROM discord_messages WHERE created_at >= $__timeFrom() AND created_at <= $__timeTo() AND author_is_bot = false AND content IS NOT NULL AND content <> '' AND LENGTH(content) > 3), filtered_words AS (SELECT word FROM words WHERE LENGTH(word) > 3 AND word NOT IN ('this', 'that', 'with', 'have', 'will', 'from', 'they', 'been', 'were', 'said', 'each', 'which', 'their', 'what', 'about', 'would', 'there', 'could', 'more', 'very', 'than', 'just', 'like', 'only', 'into', 'over', 'also', 'back', 'after', 'use', 'two', 'how', 'our', 'work', 'first', 'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us', 'automod', 'blocked', 'analysis', 'scam', 'banned', 'indicates', 'aliases', 'message', 'user')) SELECT word AS \"Word\", COUNT(*) AS \"Frequency\" FROM filtered_words GROUP BY word ORDER BY COUNT(*) DESC LIMIT 25;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "displayMode": "list",
            "filterable": false,
            "showUnfilled": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Word"
            },
            "properties": [
              {
                "id": "custom.axisPlacement",
                "value": "bottom"
              },
              {
                "id": "custom.axisLabel",
                "value": "Words"
              }
            ]
          }
        ]
      },
      "options": {
        "orientation": "vertical",
        "displayMode": "gradient",
        "xTickLabelRotation": 45,
        "xTickLabelSpacing": 0,
        "showValue": "always",
        "groupWidth": 0.7,
        "barWidth": 0.97
      }
    },
    {
      "id": 15,
      "title": "Most Common Words in Telegram",
      "type": "barchart",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 14},
      "targets": [
        {
          "format": "table",
          "rawSql": "WITH words AS (SELECT unnest(string_to_array(lower(regexp_replace(text, '[^a-zA-Z0-9\\s]', '', 'g')), ' ')) AS word FROM telegram_messages WHERE date >= $__timeFrom() AND date <= $__timeTo() AND text IS NOT NULL AND text <> '' AND LENGTH(text) > 3), filtered_words AS (SELECT word FROM words WHERE LENGTH(word) > 3 AND word NOT IN ('this', 'that', 'with', 'have', 'will', 'from', 'they', 'been', 'were', 'said', 'each', 'which', 'their', 'what', 'about', 'would', 'there', 'could', 'more', 'very', 'than', 'just', 'like', 'only', 'into', 'over', 'also', 'back', 'after', 'use', 'two', 'how', 'our', 'work', 'first', 'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us')) SELECT word AS \"Word\", COUNT(*) AS \"Frequency\" FROM filtered_words GROUP BY word ORDER BY COUNT(*) DESC LIMIT 25;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "displayMode": "list",
            "filterable": false,
            "showUnfilled": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Word"
            },
            "properties": [
              {
                "id": "custom.axisPlacement",
                "value": "bottom"
              },
              {
                "id": "custom.axisLabel",
                "value": "Words"
              }
            ]
          }
        ]
      },
      "options": {
        "orientation": "vertical",
        "displayMode": "gradient",
        "xTickLabelRotation": 45,
        "xTickLabelSpacing": 0,
        "showValue": "always",
        "groupWidth": 0.7,
        "barWidth": 0.97
      }
    },
    {
      "id": 18,
      "title": "Discord Server Joins & Leaves",
      "type": "timeseries",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 6, "w": 12, "x": 0, "y": 8},
      "targets": [
        {
          "format": "time_series",
          "rawSql": "SELECT date_trunc('day', occurred_at) AS time, 'Joins' AS metric, COUNT(*) AS value FROM discord_actions WHERE action_type = 'member_join' AND occurred_at >= $__timeFrom() AND occurred_at <= $__timeTo() GROUP BY time UNION ALL SELECT date_trunc('day', occurred_at) AS time, 'Leaves' AS metric, COUNT(*) AS value FROM discord_actions WHERE action_type = 'member_leave' AND occurred_at >= $__timeFrom() AND occurred_at <= $__timeTo() GROUP BY time ORDER BY time;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 2,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "auto",
            "pointSize": 5,
            "stacking": {
              "mode": "none",
              "group": "A"
            }
          }
        }
      }
    },
    {
      "id": 19,
      "title": "Telegram Server Joins & Leaves",
      "type": "timeseries",
      "datasource": {"type": "postgres", "uid": "supabase"},
      "gridPos": {"h": 6, "w": 12, "x": 12, "y": 8},
      "targets": [
        {
          "format": "time_series",
          "rawSql": "SELECT date_trunc('day', date) AS time, 'Joins' AS metric, COUNT(*) AS value FROM telegram_messages WHERE new_chat_members IS NOT NULL AND date >= $__timeFrom() AND date <= $__timeTo() GROUP BY time UNION ALL SELECT date_trunc('day', date) AS time, 'Leaves' AS metric, COUNT(*) AS value FROM telegram_messages WHERE left_chat_member IS NOT NULL AND date >= $__timeFrom() AND date <= $__timeTo() GROUP BY time ORDER BY time;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 2,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "auto",
            "pointSize": 5,
            "stacking": {
              "mode": "none",
              "group": "A"
            }
          }
        }
      }
    }
  ],
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {},
  "refresh": "5m",
  "version": 1
}